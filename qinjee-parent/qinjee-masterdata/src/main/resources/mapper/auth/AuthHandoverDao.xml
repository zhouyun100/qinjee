<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qinjee.masterdata.dao.auth.AuthHandoverDao">

    <!-- 用户角色托管 -->
    <insert id="roleTrusteeshipByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO">
        insert into t_user_role (
            role_id,
            archive_id,
            <if test="isTrusteeship != null">
                is_trusteeship,
            </if>
            <if test="trusteeshipBeginTime != null">
                trusteeship_begin_time,
            </if>
            <if test="trusteeshipEndTime != null">
                trusteeship_end_time,
            </if>
            operator_id,
            is_delete)
        values (
            #{roleId,jdbcType=INTEGER},
            #{acceptArchiveId,jdbcType=INTEGER},
            <if test="isTrusteeship != null">
                #{isTrusteeship,jdbcType=TINYINT},
            </if>
            <if test="trusteeshipBeginTime != null">
                #{trusteeshipBeginTime,jdbcType=TIMESTAMP},
            </if>
            <if test="trusteeshipEndTime != null">
                #{trusteeshipEndTime,jdbcType=TIMESTAMP},
            </if>
            #{operatorId,jdbcType=INTEGER},
            0)
    </insert>

    <!-- 用户机构托管 -->
    <insert id="orgTrusteeshipByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO" >
        insert into t_user_org_auth (
        org_id,
        archive_id,
        <if test="isTrusteeship != null">
            is_trusteeship,
        </if>
        <if test="trusteeshipBeginTime != null">
            trusteeship_begin_time,
        </if>
        <if test="trusteeshipEndTime != null">
            trusteeship_end_time,
        </if>
        operator_id,
        is_delete)
        values (
        #{orgId,jdbcType=INTEGER},
        #{acceptArchiveId,jdbcType=INTEGER},
        <if test="isTrusteeship != null">
            #{isTrusteeship,jdbcType=TINYINT},
        </if>
        <if test="trusteeshipBeginTime != null">
            #{trusteeshipBeginTime,jdbcType=TIMESTAMP},
        </if>
        <if test="trusteeshipEndTime != null">
            #{trusteeshipEndTime,jdbcType=TIMESTAMP},
        </if>
        #{operatorId,jdbcType=INTEGER},
        0)
    </insert>

    <!-- 角色回收 -->
    <update id="roleRecoveryByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO">
        update t_user_role set operator_id = #{operatorId,jdbcType=INTEGER},is_delete = 1
        where archive_id = #{archiveId,jdbcType=INTEGER} and role_id = #{roleId,jdbcType=INTEGER} and is_delete = 0
    </update>

    <!-- 角色移交 -->
    <update id="roleHandoverByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO">
        update t_user_role set archive_id = #{acceptArchiveId,jdbcType=INTEGER}, operator_id = #{operatorId,jdbcType=INTEGER}
        where archive_id = #{handoverArchiveId,jdbcType=INTEGER} and role_id = #{roleId,jdbcType=INTEGER} and is_delete = 0
    </update>

    <!-- 机构回收 -->
    <update id="orgRecoveryByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO">
        update t_user_org_auth set operator_id = #{operatorId,jdbcType=INTEGER},is_delete = 1
        where archive_id = #{archiveId,jdbcType=INTEGER} and org_id = #{orgId,jdbcType=INTEGER} and is_delete = 0
    </update>

    <!-- 机构移交 -->
    <update id="orgHandoverByArchiveId" parameterType="com.qinjee.masterdata.model.vo.auth.RequestRoleVO">
        update t_user_org_auth set operator_id = #{operatorId,jdbcType=INTEGER},archive_id = #{acceptArchiveId,jdbcType=INTEGER}
        where archive_id = #{handoverArchiveId,jdbcType=INTEGER} and org_id = #{orgId,jdbcType=INTEGER} and is_delete = 0
    </update>

</mapper>
