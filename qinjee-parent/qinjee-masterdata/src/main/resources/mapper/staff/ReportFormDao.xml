<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qinjee.masterdata.dao.staffdao.reportDao.ReportFormDao">
  <resultMap id="RegulationDetailMap" type="com.qinjee.masterdata.model.vo.staff.RegulationDetailVo">
    <id column="archive_id" jdbcType="INTEGER" property="archiveId" />
    <result column="business_unit_id" jdbcType="INTEGER" property="businessUnitId" />
    <result column="org_id" jdbcType="INTEGER" property="orgId" />
    <result column="post_id" jdbcType="INTEGER" property="postId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="org_name" jdbcType="VARCHAR" property="orgName" />
    <result column="business_unit_name" jdbcType="VARCHAR" property="businessUnitName" />
    <result column="post_name" jdbcType="VARCHAR" property="postName" />
    <result column="position_name" jdbcType="VARCHAR" property="positionName" />
    <result column="change_reason" jdbcType="VARCHAR" property="changeReason" />
    <result column="change_date" jdbcType="DATE" property="changeDate" />
  </resultMap>


  <select id="selectOrgIncreaseMemberDetail" resultMap="RegulationDetailMap">
    SELECT
       tua.user_name,
      tua.archive_id,
      org.org_name,
      org.org_id,
      track.before_org_id,
      track.after_org_id,
      unit.org_name business_unit_name,
      tp.post_name,
      tpo.position_name,
      track.after_position_id,
       track.before_position_id,
      track.after_post_id,
      track.after_user_category,
      track.before_user_category,
      track.change_reason,
      track.change_date
    FROM
      t_archive_career_track track
      LEFT JOIN t_organization unit
        ON track.after_business_unit_id = unit.org_id
      LEFT JOIN t_organization org
        ON track.after_org_id = org.org_id
      LEFT JOIN t_post tp
        ON track.after_post_id = tp.post_id
      LEFT JOIN t_user_archive tua
        ON track.archive_id = tua.archive_id
      LEFT JOIN t_position tpo
        ON track.after_position_id = tpo.position_id
    WHERE (
        track.after_user_category = 'INTERNSHIP'
        OR track.after_user_category = 'ON_TRAIL'
        OR track.after_user_category = 'REGULAR_EMPLOYEE'
      )
      and   org.org_id =#{orgId}
        AND  track.change_date >= #{startDate,jdbcType=DATE}
        AND #{endDate,jdbcType=DATE} >= track.change_date
  </select>

  <select id="selectOrgDecreaseMemberDetail" resultMap="RegulationDetailMap">
    SELECT
      tua.user_name,
      tua.archive_id,
      org.org_name,
      org.org_id,
      track.before_org_id,
      track.after_org_id,
      unit.org_name business_unit_name,
      tp.post_name,
      tpo.position_name,
      track.after_position_id,
       track.before_position_id,
      track.after_post_id,
      track.after_user_category,
      track.before_user_category,
      track.change_reason,
      track.change_date
    FROM
      t_archive_career_track track
      LEFT JOIN t_organization unit
        ON track.before_business_unit_id = unit.org_id
      LEFT JOIN t_organization org
        ON track.before_org_id = org.org_id
      LEFT JOIN t_post tp
        ON track.after_post_id = tp.post_id
      LEFT JOIN t_user_archive tua
        ON track.archive_id = tua.archive_id
      LEFT JOIN t_position tpo
        ON track.before_position_id = tpo.position_id
      WHERE ((
          track.after_user_category = 'INTERNSHIP'
          OR track.after_user_category = 'ON_TRAIL'
          OR track.after_user_category = 'REGULAR_EMPLOYEE'
        )
        OR (
        track.after_user_category = 'LEAVE_OFFICE' OR track.after_user_category = 'RETIRE' ))
        and org.org_id =#{orgId} AND  track.change_date >= #{startDate,jdbcType=DATE} AND #{endDate,jdbcType=DATE} >= track.change_date
  </select>

</mapper>