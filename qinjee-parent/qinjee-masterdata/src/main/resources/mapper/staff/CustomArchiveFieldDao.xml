<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qinjee.masterdata.dao.staffdao.commondao.CustomArchiveFieldDao">
  <resultMap id="BaseResultMap" type="com.qinjee.masterdata.model.entity.CustomArchiveField">
    <id column="field_id" jdbcType="INTEGER" property="fieldId" />
    <result column="field_name" jdbcType="VARCHAR" property="fieldName" />
    <result column="field_code" jdbcType="VARCHAR" property="fieldCode" />
    <result column="field_type" jdbcType="VARCHAR" property="fieldType" />
    <result column="code_id" jdbcType="INTEGER" property="codeId" />
    <result column="code_name" jdbcType="VARCHAR" property="codeName" />
    <result column="default_value" jdbcType="VARCHAR" property="defaultValue" />
    <result column="val_length" jdbcType="INTEGER" property="valLength" />
    <result column="val_precision" jdbcType="INTEGER" property="valPrecision" />
    <result column="table_id" jdbcType="INTEGER" property="tableId" />
    <result column="group_id" jdbcType="INTEGER" property="groupId" />
    <result column="is_system_define" jdbcType="SMALLINT" property="isSystemDefine" />
    <result column="sort" jdbcType="INTEGER" property="sort" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="creator_id" jdbcType="INTEGER" property="creatorId" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_delete" jdbcType="SMALLINT" property="isDelete" />
  </resultMap>
  <sql id="Base_Column_List">
    field_id, field_name,field_code, field_type,  code_id, code_name, default_value,
    val_length, val_precision, table_id, group_id, is_system_define, sort, create_time,
    creator_id, update_time, is_delete
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_custom_archive_field
    where field_id = #{fieldId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from t_custom_archive_field
    where field_id = #{fieldId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="field_id" keyProperty="fieldId" parameterType="com.qinjee.masterdata.model.entity.CustomArchiveField" useGeneratedKeys="true">
    insert into t_custom_archive_field (field_name,field_code, field_type,
      code_id, code_name, default_value,
      val_length, val_precision, table_id,
      group_id, is_system_define, sort,
      create_time, creator_id, update_time,
      is_delete)
    values (#{fieldName,jdbcType=VARCHAR},#{fieldCode,jdbcType=VARCHAR}, #{fieldType,jdbcType=VARCHAR},
      #{codeId,jdbcType=INTEGER}, #{codeName,jdbcType=VARCHAR}, #{defaultValue,jdbcType=VARCHAR},
      #{valLength,jdbcType=INTEGER}, #{valPrecision,jdbcType=INTEGER}, #{tableId,jdbcType=INTEGER},
      #{groupId,jdbcType=INTEGER}, #{isSystemDefine,jdbcType=SMALLINT}, #{sort,jdbcType=INTEGER},
      #{createTime,jdbcType=TIMESTAMP}, #{creatorId,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP},
      #{isDelete,jdbcType=SMALLINT})
  </insert>
  <insert id="insertSelective" keyColumn="field_id" keyProperty="fieldId" parameterType="com.qinjee.masterdata.model.entity.CustomArchiveField" useGeneratedKeys="true">
    insert into t_custom_archive_field
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="fieldName != null">
        field_name,
      </if>
      <if test="fieldCode != null">
      field_code,
      </if>
      <if test="fieldType != null">
        field_type,
      </if>
      <if test="codeId != null">
        code_id,
      </if>
      <if test="codeName != null">
        code_name,
      </if>
      <if test="defaultValue != null">
        default_value,
      </if>
      <if test="valLength != null">
        val_length,
      </if>
      <if test="valPrecision != null">
        val_precision,
      </if>
      <if test="tableId != null">
        table_id,
      </if>
      <if test="groupId != null">
        group_id,
      </if>
      <if test="isSystemDefine != null">
        is_system_define,
      </if>
      <if test="sort != null">
        sort,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="creatorId != null">
        creator_id,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="fieldName != null">
        #{fieldName,jdbcType=VARCHAR},
      </if>
      <if test="fieldCode != null">
      #{fieldCode,jdbcType=VARCHAR},
     </if>
      <if test="fieldType != null">
        #{fieldType,jdbcType=VARCHAR},
      </if>
      <if test="codeId != null">
        #{codeId,jdbcType=INTEGER},
      </if>
      <if test="codeName != null">
        #{codeName,jdbcType=VARCHAR},
      </if>
      <if test="defaultValue != null">
        #{defaultValue,jdbcType=VARCHAR},
      </if>
      <if test="valLength != null">
        #{valLength,jdbcType=INTEGER},
      </if>
      <if test="valPrecision != null">
        #{valPrecision,jdbcType=INTEGER},
      </if>
      <if test="tableId != null">
        #{tableId,jdbcType=INTEGER},
      </if>
      <if test="groupId != null">
        #{groupId,jdbcType=INTEGER},
      </if>
      <if test="isSystemDefine != null">
        #{isSystemDefine,jdbcType=SMALLINT},
      </if>
      <if test="sort != null">
        #{sort,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorId != null">
        #{creatorId,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=SMALLINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.qinjee.masterdata.model.entity.CustomArchiveField">
    update t_custom_archive_field
    <set>
      <if test="fieldName != null">
        field_name = #{fieldName,jdbcType=VARCHAR},
      </if>
      <if test="fieldCode != null">
        field_code = #{fieldCode,jdbcType=VARCHAR},
      </if>
      <if test="fieldType != null">
        field_type = #{fieldType,jdbcType=VARCHAR},
      </if>
      <if test="codeId != null">
        code_id = #{codeId,jdbcType=INTEGER},
      </if>
      <if test="codeName != null">
        code_name = #{codeName,jdbcType=VARCHAR},
      </if>
      <if test="defaultValue != null">
        default_value = #{defaultValue,jdbcType=VARCHAR},
      </if>
      <if test="valLength != null">
        val_length = #{valLength,jdbcType=INTEGER},
      </if>
      <if test="valPrecision != null">
        val_precision = #{valPrecision,jdbcType=INTEGER},
      </if>
      <if test="tableId != null">
        table_id = #{tableId,jdbcType=INTEGER},
      </if>
      <if test="groupId != null">
        group_id = #{groupId,jdbcType=INTEGER},
      </if>
      <if test="isSystemDefine != null">
        is_system_define = #{isSystemDefine,jdbcType=SMALLINT},
      </if>
      <if test="sort != null">
        sort = #{sort,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorId != null">
        creator_id = #{creatorId,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        is_delete = #{isDelete,jdbcType=SMALLINT},
      </if>
    </set>
    where field_id = #{fieldId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.qinjee.masterdata.model.entity.CustomArchiveField">
    update t_custom_archive_field
    set field_name = #{fieldName,jdbcType=VARCHAR},
        field_code = #{fieldCode,jdbcType=VARCHAR},
      field_type = #{fieldType,jdbcType=VARCHAR},
      code_id = #{codeId,jdbcType=INTEGER},
      code_name = #{codeName,jdbcType=VARCHAR},
      default_value = #{defaultValue,jdbcType=VARCHAR},
      val_length = #{valLength,jdbcType=INTEGER},
      val_precision = #{valPrecision,jdbcType=INTEGER},
      table_id = #{tableId,jdbcType=INTEGER},
      group_id = #{groupId,jdbcType=INTEGER},
      is_system_define = #{isSystemDefine,jdbcType=SMALLINT},
      sort = #{sort,jdbcType=INTEGER},
    where field_id = #{fieldId,jdbcType=INTEGER}
  </update>
  <select id="selectMaxPrimaryKey" resultType="java.lang.Integer">
    select MAX(field_id)
    from t_custom_archive_field
    WHERE is_delete=0
  </select>
  <update id="deleteCustomField">
    update  t_custom_archive_field
    set
    is_delete=1
    where field_id
    in <foreach collection="list" item="item" open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>


  <select id="selectCodeId" resultType="java.lang.Integer">
    select code_id
    from t_custom_archive_field
    where field_id = #{customArchiveFieldId,jdbcType=INTEGER}
  </select>

  <update id="updatePreEmploymentField" parameterType="map" >
    <foreach item="value" index="key" collection="map.entrySet()" separator=";" >
      UPDATE t_custom_archive_field
      <set>
        field_name= $(#{value})
      </set>
      WHERE field_id= #{key} AND is_delete=0
    </foreach>
  </update>


  <select id="selectPhysicName" resultType="java.lang.String">
    select  field_code
     from t_custom_archive_field
    where  field_id = #{fieldId,jdbcType=INTEGER}
     AND is_delete=0
  </select>

  <select id="selectFieldCodeByList" resultType="java.lang.String">
    select field_code
    from t_custom_archive_field
    where  field_id  in
    <foreach collection="sortList" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    AND is_delete=0
  </select>
  <select id="selectFieldByTableId" resultType="com.qinjee.masterdata.model.entity.CustomArchiveField" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_custom_archive_field
    where table_id = #{customArchiveTableId,jdbcType=INTEGER}
    AND is_delete=0
  </select>


  <select id="selectFieldCodeListByTableIdList" resultType="java.lang.String">
    select  field_code
    from    t_custom_archive_field
    where   table_id
    in
    <foreach collection="tableIdList" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
  <select id="selectTypeByFieldId" resultType="java.lang.String">
    select field_type
    from t_custom_archive_field
    where  field_id  = #{fieldId,jdbcType=INTEGER}
    AND is_delete=0;
  </select>

  <select id="selectFieldTypeByNameList" resultType="java.lang.String">
    select field_type
    from  t_custom_archive_field
    where  field_name in
    <foreach collection="heads" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    AND is_delete=0
  </select>

  <select id="selectFieldByTableIdAndAuth" resultType="java.lang.String">
  select field.field_name from
    t_user_archive arc
    right join t_user_role role on (role.archive_id=arc.archive_id and arc.archive_id=#{archiveId})
    right join t_role_custom_field_auth auth on role.role_id=auth.role_id
    right join t_custom_archive_field field on field.field_id=auth.field_id
    where field.table_id=#{tableId}
    and arc.is_delete=0 and role.is_delete=0 and auth.is_delete=0 and field.is_delete=0
  </select>

  <select id="selectFieldByArcAndAuth" resultType="java.lang.String">
 select DISTINCT(field.field_name) from
    t_user_archive arc
    right join t_user_role role on (role.archive_id=arc.archive_id and arc.archive_id=#{achiveId})
    right join t_role_custom_field_auth auth on role.role_id=auth.role_id
    right join t_custom_archive_table arctable on (arctable.func_code="ARCHIVE" and arctable.company_id=#{companyId})
    right join t_custom_archive_field field on arctable.table_id=field.table_id
    where  arc.is_delete=0 and role.is_delete=0 and auth.is_delete=0 and field.is_delete=0 and arctable.is_delete=0
  </select>
  <select id="selectCustomArchiveField" resultType="com.qinjee.masterdata.model.entity.CustomArchiveField" resultMap="BaseResultMap">
  select field.*  from
  t_custom_archive_field field
  left join t_custom_archive_group gro on gro.group_id=field.group_id
  where
  gro.group_id=#{customArchiveGroupId}
  and field.is_delete=0 and gro.is_delete=0
 </select>


    <select id="selectFieldNameByTableName" resultType="com.qinjee.masterdata.model.entity.CustomArchiveField">
      select
      <include refid="Base_Column_List"/>
      from t_custom_archive_field field
      left join t_custom_archive_table tab on field.table_id=tab.table_id
      where field.is_delete=0 and tab.is_delete=0
      and tab.table_name=#{preEmployment} and tab.company_id=#{companyId}
    </select>
  <select id="selectFieldIdByFieldNameAndCompanyId" resultType="java.lang.Integer">
    select field_id
    from t_custom_archive_field field
    inner join t_custom_archive_table tab on tab.table_id=field.table_id
    where tab.company_id=#{companyId}
    and tab.func_code=#{funcCode}
    and field.field_name in
    <foreach collection="fieldNames" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and field.is_delete=0
    and tab.is_delete=0
    and table.is_enable=1
  </select>

  <select id="seleleIsSysAndTableIdAndTableName" resultType="java.util.Map">
        select field.table_id,field.is_system_define,tab.table_name
        from t_custom_archive_field field
        left join t_custom_archive_table tab on tab.table_id= field.table_id
        where field.is_delete=0
        and tab.is_delete=0
        and field_name in
        <foreach collection="strings" item="item" open="(" separator="," close=")">
          #{item}
        </foreach>
  </select>
  <select id="selectFieldCodeByName" resultType="java.lang.String">
   select field_code
    from t_custom_archive_field field
    left join t_custom_archive_table tab on field.table_id=tab.table_id
    where field_name=#{head}
    and tab.company_id=#{companyId}
    and field.is_delete=0
  </select>
  <select id="selectFieldIdByFieldNameAndCompanyIdAndFuncCode" resultType="java.lang.Integer">
    select field_id
    from t_custom_archive_field field
    inner join t_custom_archive_table tab on tab.table_id=field.table_id
    where tab.company_id=#{companyId}
    and tab.func_code=#{funcCode}
    and field.field_name =#{key}
    and tab.is_delete=0
    and field.is_delete=0
  </select>
  <select id="selectFieldCodeByNameAndFuncCodeAndCompanyId" resultType="java.lang.String">
    select field_code
    from t_custom_archive_field field
    left join t_custom_archive_table tab on tab.table_id=field.table_id
    where field_name=#{s}
    and tab.func_code=#{funcCode}
    and tab.company_id=#{companyId}
    and field.is_delete=0
    and tab.is_enable=1
    and tab.is_delete=0
  </select>
  <select id="selectFieldNameByCodeList" resultType="java.lang.String">
    select  field_name
    from  t_custom_archive_field field
    left join t_custom_archive_table tab on tab.table_id=field.table_id
    where tab.company_id=#{companyId}
    and tab.func_code="ARC"
    and tab.is_delete=0
    and tab.is_enable=1
    and field_code in
    <foreach collection="strings" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    AND field. is_delete=0
  </select>
  <select id="selectNameAndIdAndIsSystemDefine" resultType="java.util.Map">
    select is_system_define,table_id
    from t_custom_archive_field
    where field_id in
    <foreach collection="idList" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and is_delete=0
  </select>

  <select id="selectSymbolForPreIdNumber" resultType="java.lang.Integer">
    select
    field_id
    from t_custom_archive_field
    where field_id in
    <foreach collection="list" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and field_code="id_number"
  </select>
  <select id="selectSymbolForPreIdType" resultType="java.lang.Integer">
    select
    field_id
    from t_custom_archive_field
    where field_id in
    <foreach collection="list" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and field_code="id_type"
  </select>
  <select id="selectSymbolForArcEmploymentNumber" resultType="java.lang.Integer">
    select
    field_id
    from t_custom_archive_field
    where field_id in
    <foreach collection="list" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and  field_code="employment_number"
  </select>
  <select id="selectSymbolForArcIdNumber" resultType="java.lang.Integer">
    select
    field_id
    from t_custom_archive_field
    where field_id in
    <foreach collection="list" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
    and  field_code="id_number"
  </select>
  <select id="selectTableIdByFieldId" resultType="java.lang.Integer">
    select table_id from t_custom_archive_field where field_id=#{integer1} and is_delete=0
  </select>

  <select id="selectCodeAndTypeById" resultType="java.util.Map">
    select field_code,text_type from t_custom_archive_field
    where id=#{integer}
    and is_delete=0

  </select>
</mapper>
